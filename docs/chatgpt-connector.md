# ChatGPT Connector Setup (Apps SDK / MCP)

This guide shows the exact fields to configure in the ChatGPT connector UI and how to validate the first run.

## Prerequisites
- Your gateway deployed to Cloud Run (see Quickstart)
- Auth0 tenant configured (API, RBAC on, RS256, optional DCR)
- The gateway base URL: `https://<YOUR_GATEWAY_DOMAIN>`
- Your Auth0 domain: `<AUTH0_DOMAIN>` (e.g., `yourtenant.us.auth0.com`)

## Connector configuration
In ChatGPT → **Create connector** (Web App / OAuth):

**Authorization**
- **Auth type:** OAuth 2.0 (PKCE)
- **Authorization URL:** `https://<AUTH0_DOMAIN>/authorize`
- **Token URL:** `https://<AUTH0_DOMAIN>/oauth/token`
- **Client type:** Public (no client secret)
- **Scopes:** `openid profile email offline_access messages:read messages:write`

> **Note:** You typically leave **Audience** empty in the ChatGPT UI. The gateway will verify `aud` on the received token and reject mismatches.

**Redirect URIs**
- Copy the Redirect URI generated by ChatGPT and paste it into Auth0 → Application → **Allowed Callback URLs** (and **Allowed Logout URLs** if required).

## Expected first run
1. Click **Authorize** in ChatGPT → you should see your Auth0 login page.
2. After login/consent, ChatGPT calls your gateway with a Bearer token.
3. Your gateway verifies JWT (`iss`, `aud`, `exp`, `nbf`), enforces scopes, and returns a JSON result.

## Quick validation
- Call the protected resource endpoint without a token:
  ```bash
  curl -i https://<YOUR_GATEWAY_DOMAIN>/.well-known/oauth-protected-resource
  # Expect: 401
  ```
- Then authorize in ChatGPT and run a tool that calls the same endpoint; you should get **200**.

## Common issues
- **401 (opaque token)**: Ensure your Auth0 API uses **RS256** and **Add permissions in the access token** is enabled.
- **403 (insufficient_scope)**: Add the needed permission to your API and re-consent in ChatGPT.
- **401 (audience mismatch)**: Check `AUTH0_AUDIENCE` in your gateway and the `aud` claim in the token.
